### Smart IoT Kitchen Devices Service - API Tests

### Health Check
GET http://localhost:3001/health

### Create a new kitchen device
POST http://localhost:3001/api/devices
Content-Type: application/json

{
  "deviceId": "KITCHEN-ESP32-LED1",
  "ownerId": "user123",
  "name": "Kitchen Smart Controller",
  "location": {
    "room": "kitchen",
    "floor": "1"
  },
  "outlets": [
    {"id": "o1", "name": "Microwave", "type": "kitchen"},
    {"id": "o2", "name": "Coffee Maker", "type": "kitchen"},
    {"id": "o3", "name": "Toaster", "type": "kitchen"},
    {"id": "o4", "name": "Ventilation Fan", "type": "safety"},
    {"id": "o5", "name": "Emergency Light", "type": "safety"}
  ],
  "thresholds": {
    "temperature": {"min": 15, "max": 50},
    "humidity": {"min": 30, "max": 80},
    "smoke": {"max": 100},
    "gas": {"max": 1000}
  }
}

### Get all devices
GET http://localhost:3001/api/devices

### Get device by ID
GET http://localhost:3001/api/devices/KITCHEN-ESP32-LED1

### Get device status
GET http://localhost:3001/api/devices/KITCHEN-ESP32-LED1/status

### Toggle outlet (turn on microwave)
PUT http://localhost:3001/api/devices/KITCHEN-ESP32-LED1/outlets/o1/toggle
Content-Type: application/json

{
  "status": true
}

### Toggle outlet (turn off coffee maker)
PUT http://localhost:3001/api/devices/KITCHEN-ESP32-LED1/outlets/o2/toggle
Content-Type: application/json

{
  "status": false
}

### Update device thresholds
PUT http://localhost:3001/api/devices/KITCHEN-ESP32-LED1/thresholds
Content-Type: application/json

{
  "thresholds": {
    "temperature": {"min": 10, "max": 60},
    "smoke": {"max": 80}
  }
}

### Send telemetry data (normal conditions)
POST http://localhost:3001/api/logs
Content-Type: application/json

{
  "type": "telemetry",
  "deviceId": "KITCHEN-ESP32-LED1",
  "topic": "iot/KITCHEN-ESP32-LED1/telemetry",
  "payload": {
    "ts": 676489,
    "temp": 32.3,
    "humid": 53,
    "smoke": 0,
    "gas_ppm": 335.275,
    "o": {
      "o1": true,
      "o2": false,
      "o3": false,
      "o4": false,
      "o5": false
    }
  },
  "severity": "low"
}

### Send telemetry data (emergency conditions - high temperature)
POST http://localhost:3001/api/logs
Content-Type: application/json

{
  "type": "telemetry",
  "deviceId": "KITCHEN-ESP32-LED1",
  "topic": "iot/KITCHEN-ESP32-LED1/telemetry",
  "payload": {
    "ts": 676490,
    "temp": 65.5,
    "humid": 45,
    "smoke": 0,
    "gas_ppm": 200,
    "o": {
      "o1": true,
      "o2": false,
      "o3": false,
      "o4": false,
      "o5": false
    }
  },
  "severity": "critical"
}

### Send telemetry data (emergency conditions - smoke detected)
POST http://localhost:3001/api/logs
Content-Type: application/json

{
  "type": "telemetry",
  "deviceId": "KITCHEN-ESP32-LED1",
  "topic": "iot/KITCHEN-ESP32-LED1/telemetry",
  "payload": {
    "ts": 676491,
    "temp": 45.2,
    "humid": 60,
    "smoke": 150,
    "gas_ppm": 300,
    "o": {
      "o1": true,
      "o2": false,
      "o3": false,
      "o4": false,
      "o5": false
    }
  },
  "severity": "critical"
}

### Get device logs
GET http://localhost:3001/api/logs?deviceId=KITCHEN-ESP32-LED1&limit=10

### Get emergency logs
GET http://localhost:3001/api/logs/emergency

### Get latest telemetry
GET http://localhost:3001/api/logs/KITCHEN-ESP32-LED1/latest

### Get telemetry history (last 24 hours)
GET http://localhost:3001/api/logs/KITCHEN-ESP32-LED1/history?hours=24

### Manually enter emergency mode
PUT http://localhost:3001/api/devices/KITCHEN-ESP32-LED1/emergency/enter

### Check device status after emergency
GET http://localhost:3001/api/devices/KITCHEN-ESP32-LED1/status

### Exit emergency mode
PUT http://localhost:3001/api/devices/KITCHEN-ESP32-LED1/emergency/exit

### Process unprocessed logs
POST http://localhost:3001/api/logs/process

### Clean old logs (older than 30 days)
DELETE http://localhost:3001/api/logs/cleanup?days=30

### Update device
PUT http://localhost:3001/api/devices/KITCHEN-ESP32-LED1
Content-Type: application/json

{
  "name": "Updated Kitchen Smart Controller",
  "location": {
    "room": "main_kitchen",
    "floor": "1"
  }
}

### Delete device
DELETE http://localhost:3001/api/devices/KITCHEN-ESP32-LED1
